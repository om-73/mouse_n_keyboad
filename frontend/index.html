<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Gesture Mouse & Keyboard</title>
  <link rel="stylesheet" href="style.css">
  <script>
    // Configuration: Backend URL
    // When deployed, this should be updated to the Render URL.
    window.BACKEND_URL = "http://localhost:5050";

    // Save to localStorage for other pages (logs.html) to use
    localStorage.setItem("BACKEND_URL", window.BACKEND_URL);
  </script>
</head>

<body>
  <header>
    <h1>Gesture Control</h1>
    <nav>
      <!-- We can't really view logs nicely without a frontend route or just linking to backend.
           Linking to backend for now. -->
      <a href="logs.html" class="btn">View Logs</a>
      <a href="#" onclick="fetch(window.BACKEND_URL + '/quit')" class="btn danger">Quit</a>
    </nav>
  </header>

  <section class="controls">
    <div class="config-panel"
      style="margin-bottom: 10px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">
      <label style="font-size: 14px; color: #ccc;">Backend URL:</label>
      <input type="text" id="backendUrlInput" placeholder="https://your-app.onrender.com"
        style="width: 250px; padding: 5px;">
      <button id="saveUrlBtn" class="btn" style="padding: 5px 10px; font-size: 12px;">Save</button>
      <span id="connectionStatus" style="font-size: 12px; margin-left: 10px;">Checking...</span>
    </div>

    <div class="mode">
      <span>Current mode:</span>
      <strong id="modeLabel">mouse</strong>
    </div>
    <div class="buttons">
      <button class="btn" data-mode="mouse">Mouse Mode</button>
      <button class="btn" data-mode="keyboard">Keyboard Mode</button>
    </div>
    <div class="hint">
      <p><b>Mouse:</b> Move cursor with <i>Left</i> hand index; pinch thumbâ€“pinky to click.</p>
      <p><b>Keyboard:</b> Select keys with <i>Right</i> hand index finger.</p>
    </div>
  </section>

  <div id="loadingOverlay"
    style="position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); color:white; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:999;">
    <h2>Loading AI Model...</h2>
    <p>Please wait. Allow Camera Access if asked.</p>
    <p id="errorMsg" style="color: #ff4444; margin-top: 10px;"></p>
  </div>

  <section class="video">
    <div style="position: relative; width: 640px; height: 480px; margin: 0 auto;">
      <!-- Local Webcam Video -->
      <video id="webcam" style="position: absolute; width: 640px; height: 480px; transform: scaleX(-1);" autoplay
        playsinline></video>
      <!-- Canvas for drawing landmarks -->
      <canvas id="output_canvas" width="640" height="480"
        style="position: absolute; left: 0; top: 0; pointer-events: none; transform: scaleX(-1);"></canvas>
      <!-- Virtual Mouse Cursor -->
      <div id="virtual-cursor"
        style="position: absolute; width: 20px; height: 20px; background: red; border-radius: 50%; pointer-events: none; display: none; z-index: 100;">
      </div>
    </div>
  </section>

  <!-- MediaPipe Tasks Vision (Loaded via Module in script.js) -->
  <script type="module" src="script.js"></script>
</body>

</html>