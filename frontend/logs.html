<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Gesture Logs</title>
    <link rel="stylesheet" href="style.css">
    <script>
        // Configuration: Backend URL
        // This will be read from the same config window object if we shared it, 
        // or we can just redefine it or load from a config file.
        // For simplicity, let's redefine or check local storage if we had it.
        // Ideally this should match index.html
        // Configuration: Backend URL
        let defaultUrl = "http://localhost:5050";
        if (window.location.protocol === 'https:') {
            defaultUrl = "";
        }
        window.BACKEND_URL = localStorage.getItem("BACKEND_URL") || defaultUrl; 
    </script>
</head>

<body>
    <header>
        <h1>Gesture Logs</h1>
        <div class="config-panel" style="margin-top: 10px; font-size: 14px;">
            <label>Backend URL:</label>
            <input type="text" id="backendUrlInput" placeholder="https://your-app.onrender.com" style="width: 250px;">
            <button id="saveUrlBtn" class="btn" style="padding: 2px 8px;">Save</button>
            <span id="connectionStatus" style="margin-left: 10px;"></span>
        </div>
        <nav style="margin-top: 10px;">
            <a href="index.html" class="btn">Back</a>
            <button class="btn danger" onclick="deleteAllLogs()">Delete All</button>
        </nav>
    </header>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Text</th>
                <th>X</th>
                <th>Y</th>
                <th>Mode</th>
                <th>Timestamp</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody id="logs-body">
            <!-- Logs will be inserted here -->
        </tbody>
    </table>

    <p id="no-logs" style="text-align:center; display:none;">No logs yet or loading...</p>

    <script>
        <script>
        // UI Elements
            const backendInput = document.getElementById("backendUrlInput");
            const saveUrlBtn = document.getElementById("saveUrlBtn");
            const statusSpan = document.getElementById("connectionStatus");

            // Configuration
            let defaultUrl = "http://localhost:5050";
            if (window.location.protocol === 'https:') {
                defaultUrl = "";
        }
            let API_BASE = localStorage.getItem("BACKEND_URL") || defaultUrl;
            backendInput.value = API_BASE;

        // Save Logic
        saveUrlBtn.addEventListener("click", () => {
                let url = backendInput.value.trim();
            if (url.endsWith("/")) url = url.slice(0, -1);
            if (url) {
                API_BASE = url;
            localStorage.setItem("BACKEND_URL", API_BASE);
            statusSpan.textContent = "Saved.";
            fetchLogs(); // Retry
            }
        });

            async function fetchLogs() {
            if (!API_BASE) {
                statusSpan.textContent = "Please set a Backend URL.";
            return;
            }
            statusSpan.textContent = "Fetching...";
            try {
                const res = await fetch(API_BASE + "/api/logs");
            if (!res.ok) throw new Error(`Server Error: ${res.status}`);
            const logs = await res.json();
            renderLogs(logs);
            statusSpan.textContent = "Connected.";
            statusSpan.style.color = "green";
            } catch (e) {
                console.error(e);
            statusSpan.textContent = "Error";
            statusSpan.style.color = "red";
            // Show detailed error
            document.getElementById("no-logs").innerHTML = `
            <span style="color:red">Failed to load logs.</span><br>
                <small>${e.message}</small><br>
                    <small>Check Console for details.</small>
                    `;
                    document.getElementById("no-logs").style.display = "block";
            }
        }

                    function renderLogs(logs) {
            const tbody = document.getElementById("logs-body");
                    const noLogs = document.getElementById("no-logs");
                    tbody.innerHTML = "";

                    if (!logs || logs.length === 0) {
                        noLogs.textContent = "No logs yet.";
                    noLogs.style.display = "block";
                    return;
            }
                    noLogs.style.display = "none";

            logs.forEach(l => {
                const tr = document.createElement("tr");
                    tr.innerHTML = `
                    <td>${l.id}</td>
                    <td>${l.text || ''}</td>
                    <td>${l.x || ''}</td>
                    <td>${l.y || ''}</td>
                    <td>${l.mode}</td>
                    <td>${new Date(l.timestamp).toLocaleString()}</td>
                    <td>
                        <button class="btn danger" onclick="deleteLog(${l.id})">Delete</button>
                    </td>
            `;
                tbody.appendChild(tr);
            });
        }

        async function deleteLog(id) {
            if (!confirm("Delete this log?")) return;
            try {
                await fetch(API_BASE + "/delete/" + id, { method: "POST" });
                fetchLogs();
            } catch(e) { alert("Delete failed: " + e.message); }
        }

        async function deleteAllLogs() {
            if (!confirm("Delete ALL logs?")) return;
            try {
                await fetch(API_BASE + "/delete_all", { method: "POST" });
                fetchLogs();
            } catch(e) { alert("Delete failed: " + e.message); }
        }

        // Load logs on page load
        if (API_BASE) fetchLogs();
    </script>
</body>

</html>